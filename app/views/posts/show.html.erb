<div class="container">
  <div class="row justify-content-center">
    <div class="card card-top" style="width: 35rem;">
      <div class="card-body">
        <br>
        <div>
          <% @post.photos.each do |photo| %>
          <%= cl_image_tag photo.key %>
          <% end %>
        </div>
        <div class="d-block fs-3">
          <strong> <%= "Dirección:" %> </strong> <%= @post.address %>
        </div>
        <div class="d-block fs-3">
          <strong> <%= "descripción:" %> </strong> <%= @post.description %>
        </div>
        <div class="d-block fs-3">
          <strong> <%= "Recompensa:" %> </strong> <%= @post.reward ? 'Si' : 'No' %>
        </div>
        <div class="d-block fs-3">
          <strong> <%= "Estado:" %> </strong> <%= @post.status %>
        </div>
        <br>
        <div class="d-flex ">
          <% if current_user.present? %>
            <% if current_user.id == @post.user_id %>
              <%= button_to "Delete", post_path(@post), data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-danger m-1" %>
              <%= link_to "Edit", edit_post_path(@post), class: "btn btn-danger m-1" %>
            <% end %>
          <% end %>
        </div>

        <div id='map' style="width: 100%; height: 300px;"
        data-controller="map"
        data-map-markers-value="<%= @markers.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"
        ></div>

      </div>
    </div>
  </div>

  <div class="row mt-5 mr-1">
    <div class="col-12 col-sm-6">
      <h3>Reviews</h3>
      <% if @post.reviews.empty? %>
        <small><em class="text-muted">Be the first one to review this post</em></small>
      <% end %>
      <% @post.reviews.each do |review| %>
        <div>
          <p class="mb-0"><%= review.content %></p>
          <small><em class="text-muted"><%= distance_of_time_in_words_to_now(review.created_at) %> ago</em></small>
          <div class="d-flex">
            <% if current_user.present? %>
              <% if current_user == review.user %>
                <span id= "btn-<%= review.id %>">  <%= link_to "Edit", post_review_path(review), class: 'btn btn-danger m-1 ', onclick: "showContent()" %> </span>
                <%= button_to "Delete", review_path(review), data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-danger m-1" %>
              <% end %>
            <% end %>
          </div>
          <div id= "content-<%= review.id %>" style= "display: none">
            <%= simple_form_for [@post, review], method: :put, url: post_review_path(@post, review) do |f| %>
              <%= f.input :content%>
              <%= f.submit class:"btn btn-danger" %>
            <% end %>
          </div>
        </div>
        <hr>
      <% end %>
    </div>
    <div class="col-12 col-sm-6">
      <div class="bg-white rounded p-3">
        <h5>Add your review</h5>
        <%= simple_form_for [@post, @review] do |f| %>
          <%= f.input :content, placeholder: "Add your review here..." %>
          <%= f.submit class:"btn btn-danger" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  function showContent() {
    const id = event.currentTarget.href.split("/")[4]
    event.preventDefault()
    $(`#content-${id}`).show()
  }
</script>
