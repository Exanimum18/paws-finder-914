<div class="container ">
  <div class="row justify-content-center">

    <div class="card  shadow p-3 mb-5 bg-white rounded" style="width: 35rem;">
      <div class="card-body ">
      <h4 class="card-title text-center" id="titulo"> <%= @post.title %> </h4>
        <div>
          <% @post.photos.each do |photo| %>
          <%= cl_image_tag photo.key, height: 400, width: 500, class:"card-img-top mb-3" , crop: :fill %>
          <% end %>
        </div>
        <div class="d-block fs-4">
          <strong> <%= "Dirección:" %> </strong> <%= @post.address %>
        </div>
        <div class="d-block fs-4">
          <strong> <%= "descripción:" %> </strong> <%= @post.description %>
        </div>
        <div class="d-block fs-4">
          <strong> <%= "Recompensa:" %> </strong> <%= @post.reward ? 'Si' : 'No' %>
        </div>
        <div class="d-block fs-4">
          <strong> <%= "Estado:" %> </strong> <%= @post.status %>
        </div>
        <br>

        <div class="map d-flex" id='map' style="width: 100%; height: 300px;"
        data-controller="map"
        data-map-markers-value="<%= @markers.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"
        ></div>

        <div class="d-flex justify-content-center mb-3">
          <% if current_user.present? %>
            <% if current_user.id == @post.user_id %>
              <%= button_to "Borrar", post_path(@post), data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-danger m-1" %>
              <%= link_to "Editar", edit_post_path(@post), class: "btn btn-flat m-1" %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-5 mr-1">
    <div class="col-12 col-sm-6">
      <h3>Comentarios</h3>
      <% if @post.reviews.empty? %>
        <small><em class="text-muted">Sé el primero en dejar una reseña</em></small>
      <% end %>
      <% @post.reviews.each do |review| %>
        <div>
          <p class="mb-0"><%= review.content %></p>
          <small><em class="text-muted"><%= distance_of_time_in_words_to_now(review.created_at) %> ago</em></small>
          <div class="d-flex">
            <% if current_user.present? %>
              <% if current_user == review.user %>
                <span id= "btn-<%= review.id %>">  <%= link_to "Editar", post_review_path(review), class: 'btn btn-danger m-1 ', onclick: "showContent()" %> </span>
                <%= button_to "Borrar", review_path(review), data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-danger m-1" %>
              <% end %>
            <% end %>
          </div>
          <div id= "content-<%= review.id %>" style= "display: none">
            <%= simple_form_for [@post, review], method: :put, url: post_review_path(@post, review) do |f| %>
              <%= f.input :content%>
              <%= f.submit class:"btn btn-danger" %>
            <% end %>
          </div>
        </div>
        <hr>
      <% end %>
    </div>
    <div class="col-12 col-sm-6">
      <div class="bg-white rounded p-3">
        <h5>Agrega tu comentario</h5>
        <%= simple_form_for [@post, @review] do |f| %>
          <%= f.input :content,placeholder: "Agrega tu comentario aquí...", label: "Comentario" %>
          <%= f.submit class: "btn btn-danger", label: "Crear reseña" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  function showContent() {
    const id = event.currentTarget.href.split("/")[4]
    event.preventDefault()
    $(`#content-${id}`).show()
  }
</script>
